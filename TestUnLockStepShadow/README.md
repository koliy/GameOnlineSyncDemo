# 乐观帧同步(影子跟随算法)

  #### 1.解决网络高延迟下，客户端平滑移动问题。。
  #### 2.屏幕上显示的实体（entity）只是不停的追逐它的“影子”（shadow）。
  #### 3.服务器向各客户端发送各个影子的状态改变（坐标，方向，速度，时间）。
  #### 4.各个客户端收到以后按照当前重新插值修正影子状态。
  #### 5.影子状态是跳变的，但实体追赶影子是连续的，故整个过程是平滑的。
  
## 相位滞后：
   可选参数，实体与影子保持一定距离同步，相当于保持一定车距，这样在控制者突然停止的时候，不容易因为网络延迟跑过了又被拉回来。
 
## 测试：
1.需要nodejs环境

2.在项目内，执行下面命令，以便安装依赖包
``` bash
$:npm install
```
3.启动服务器
``` bash
$:node app
```
4.启动2个客户端，进入client目录下用google浏览器打开index.html。其它浏览器对socket.io兼容性不好。

## 样图:
![image](https://github.com/koliy/GameOnlineSyncDemo/blob/master/TestUnLockStepShadow/22.png)

### 图片逻辑说明：
1.客户端每5帧上报一次自己主机的状态给服务器。服务器每5帧发送所有主机的状态给所有客户端。
2.p1客户端移动时，考虑网络延迟问题，使用影子跟随算法来达到移动补偿。所以在每帧判断里面，立即响应1帧移动
并判断是否有服务端的影子状态数据发送过来，有则影子根据当前状态，每帧以当前方向移动，直到方向为0停止。
这就造成了在p1端，主机的影子跟随主机。当主机停止时，5帧后也会同步到影子的最后状态。
3.p2从机端显示，在网络延迟下，实体不跳变移动。实体追赶影子。每1帧，优先移动影子，然后根据当前影子和实体的
距离，实体插值移动，随着距离减小，实体移动到影子的位置。这就实现了平滑效果。


